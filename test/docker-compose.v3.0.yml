version: '3.0'

services:
  helloworld:
    environment:
      - BLAH=${VARIABLE:-default}
    build: .

  helloworldimage:
    image: myhelloworld
    build: .

  alpinewithfailinglink:
    image: alpine:3.3
    command: echo hello from alpine
    links:
      - fail

  fail:
    image: alpine:3.3
    command: sh -c "echo failing on purpose, expect exit 1; exit 1"

deploy:
  replicas: 6
  update_config:
    parallelism: 2
    delay: 10s
  restart_policy:
    condition: on-failure